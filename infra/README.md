Developer infra helpers for HeyAnon platform

Quick steps to rebuild API and validate metrics:

From the infra/ directory:

```powershell
# Rebuild API and run it in background
docker compose up -d --build api

# Check /metrics (PowerShell)
iwr http://localhost:8000/metrics | Select-Object -ExpandProperty Content
```

Initialize Alembic and create a baseline migration (run after API image has been rebuilt so alembic is installed):

```powershell
# initialize alembic folder if needed
docker compose exec api sh -lc "alembic init alembic || true"

# autogenerate a new migration (set MSG to a short description)
docker compose exec api sh -lc "alembic revision --autogenerate -m 'baseline'"

# apply migrations
docker compose exec api sh -lc "alembic upgrade head"
```

Convenience Make targets are available in this folder:

- `make db-init` — run `alembic init` inside api container (no-op if present)
- `make db-migrate MSG="message"` — create an autogenerate migration
- `make db-upgrade` — apply migrations (upgrade head)
- `make e2e` — run infra/e2e_test.py

If `alembic` can't find `DATABASE_URL` or `Base`, ensure `api/.env` is present and contains `DATABASE_URL`, or edit `api/alembic/env.py` to import the correct names from `app.db`.

If autogenerated migrations show diffs you don't expect, paste the generated migration here and I'll help adjust it.

Prometheus & Grafana (local)

From the `infra/` directory you can start Prometheus and Grafana alongside the stack:

```powershell
# start api + prometheus + grafana
docker compose up -d --build api prometheus grafana

# open Grafana at http://localhost:3000 (admin/admin)
# Prometheus UI at http://localhost:9090
```

Grafana is pre-provisioned with a Prometheus datasource and a basic HeyAnon dashboard. If you change the metrics names in the API, update `infra/grafana/dashboards/heyanon.json` accordingly.

Request-id & JSON logs

After applying JSON logging, you can verify propagation and correlation between bot and api logs.

1) Start api + bot:

```powershell
docker compose up -d --build api bot
```

2) Generate activity (or run the bot/e2e tests)

```powershell
iwr http://localhost:8000/health | Select-Object -ExpandProperty Content
python .\e2e_test.py
```

3) Search logs for request_id values (PowerShell):

```powershell
docker compose logs --tail=200 api | Select-String request_id
docker compose logs --tail=200 bot | Select-String request_id
```

You should see matching `request_id` values in bot outbound http_post logs and api http_req logs. The API also returns `X-Request-Id` in responses.

Staging and alert testing
-------------------------

To run a staging stack locally (mirrors production names and ports):

```powershell
# copy a local env for staging
cp .env .env.staging
docker compose -f docker-compose.staging.yml up -d --build
```

Alert testing helpers:

1) Synthetic alerts (post directly to Alertmanager API):

```powershell
# send a synthetic alert to alertmanager
powershell -File .\alert_test.ps1 -SendSyntheticAlert
```

2) Simulate API error load (generate 4xx/5xx):

```powershell
powershell -File .\alert_test.ps1 -SpamErrors
```

3) Stale heartbeat: stop a bot container and wait ~3 min:

```powershell
docker compose stop bot
# wait ~3 minutes, then check Alertmanager/Discord
```

